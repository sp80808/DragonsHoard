
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Dragon's Hoard 2048</title>
    
    <!-- Facebook Instant Games SDK (Keep for FB Platform) -->
    <script src="https://connect.facebook.net/en_US/fbinstant.6.3.js"></script>
    
    <!-- Facebook JS SDK (For Web/itch.io Hosting) -->
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1734049544181820'); 
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1734049544181820&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:wght@400;700&display=swap');
      
      :root {
        /* Biome Colors Variables */
        --biome-outskirts: #0f172a;
        --biome-threshold: #1c1917;
        --biome-hall: #1e1b4b;
        --biome-hoard: #451a03;
        
        /* Dynamic Mouse Variables */
        --mouse-x: 0.5;
        --mouse-y: 0.5;
      }

      html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Lato', sans-serif;
        background-color: #050505;
        color: #e2e8f0;
        overflow: hidden; /* Prevent scrolling on mobile swipes */
        touch-action: none; /* Disable browser handling of gestures */
        user-select: none; /* Prevent text highlighting during play */
        -webkit-user-select: none;
      }
      
      #root {
        height: 100%;
        width: 100%;
      }
      
      h1, h2, h3, .fantasy-font {
        font-family: 'Cinzel', serif;
      }

      /* Badge Pulse Animation */
      @keyframes badgePulse {
        0% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 0, 0, 0); }
        50% { transform: scale(1.4); box-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
        100% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 0, 0, 0); }
      }
      .animate-badge-pulse {
        animation: badgePulse 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      /* --- DYNAMIC ATMOSPHERE ANIMATIONS --- */

      /* Outskirts: Rolling Fog - Improved for Seamless Scroll */
      @keyframes fogFlow {
        0% { transform: translateX(0); opacity: 0.3; }
        50% { opacity: 0.5; }
        100% { transform: translateX(-100%); opacity: 0.3; } /* Assuming background repeats */
      }
      .bg-fog-layer {
        background: url('https://www.transparenttextures.com/patterns/foggy-birds.png'); /* Subtle noise pattern */
        width: 200%; /* Make it wider so it can scroll seamlessly */
        height: 100%;
        position: absolute;
        top: 0; left: 0;
        animation: fogFlow 60s linear infinite;
      }

      /* Threshold: Torch Flicker */
      @keyframes torchFlicker {
        0%, 100% { opacity: 0.1; transform: scale(1); }
        25% { opacity: 0.15; transform: scale(1.02); }
        50% { opacity: 0.1; transform: scale(0.98); }
        75% { opacity: 0.18; transform: scale(1.01); }
      }
      .bg-torch-light {
        background: radial-gradient(circle at 50% 50%, rgba(255, 160, 60, 0.15) 0%, transparent 70%);
        animation: torchFlicker 4s infinite ease-in-out;
      }

      /* Hoard: Gold Shimmer */
      @keyframes goldShimmer {
        0% { transform: translateX(-150%) skewX(-20deg); }
        100% { transform: translateX(150%) skewX(-20deg); }
      }
      .bg-gold-shimmer {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.1) 50%, transparent 100%);
        animation: goldShimmer 3s infinite linear;
      }

      /* Text Outline for Readability */
      .text-outline-black {
        text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
      }
      
      .text-stroke-sm {
        -webkit-text-stroke: 1px rgba(0,0,0,0.5);
        paint-order: stroke fill;
      }
      
      .text-stroke-md {
        -webkit-text-stroke: 2px rgba(0,0,0,0.8);
        paint-order: stroke fill;
      }

      /* CRT / Scanline Effect */
      .scanlines {
        background: linear-gradient(
          to bottom,
          rgba(255,255,255,0),
          rgba(255,255,255,0) 50%,
          rgba(0,0,0,0.1) 50%,
          rgba(0,0,0,0.1)
        );
        background-size: 100% 4px;
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
        z-index: 50;
        opacity: 0.12;
      }

      .vignette {
        background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.8) 100%);
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 40;
        transition: box-shadow 1s ease;
      }

      @keyframes bossPulse {
        0% { box-shadow: inset 0 0 0 rgba(220, 38, 38, 0); }
        50% { box-shadow: inset 0 0 100px rgba(185, 28, 28, 0.4); background-color: rgba(69, 10, 10, 0.1); }
        100% { box-shadow: inset 0 0 0 rgba(220, 38, 38, 0); }
      }

      .boss-mode {
        animation: bossPulse 3s infinite;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #1a202c; }
      ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }

      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

      /* Floating Text Animations - Clean Vertical Rise */
      @keyframes floatUpFade {
        0% { transform: translateY(0) scale(0.5); opacity: 0; filter: blur(2px); }
        20% { transform: translateY(-15px) scale(1.2); opacity: 1; filter: blur(0); }
        100% { transform: translateY(-60px) scale(1); opacity: 0; }
      }
      .animate-float-xp { animation: floatUpFade 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
      .animate-float-gold { animation: floatUpFade 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
      .animate-loot-float { animation: floatUpFade 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

      /* Tile Entry - Pop with overshoot */
      @keyframes popIn {
        0% { transform: scale(0); opacity: 0; }
        60% { transform: scale(1.15); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
      }
      /* Fixed: Added animation-fill-mode: both to prevent flash before animation starts due to delay */
      .tile-animation-enter { 
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        animation-fill-mode: both;
      }

      /* Dying Tile Exit - Shrink and Fade clearly */
      @keyframes shrinkFadeOut {
        0% { transform: scale(1); opacity: 1; filter: brightness(1.5); }
        30% { transform: scale(1.1); opacity: 0.8; }
        100% { transform: scale(0); opacity: 0; }
      }
      .tile-exit-animation { 
        animation: shrinkFadeOut 0.25s ease-out forwards; 
        z-index: 5 !important;
      }

      /* Improved Merge Pop - Dopamine inducing */
      @keyframes mergePop {
        0% { transform: scale(0.5); filter: brightness(1.5); }
        50% { transform: scale(1.25); filter: brightness(2) contrast(1.2); box-shadow: 0 0 40px rgba(255,255,255,0.6); }
        100% { transform: scale(1); filter: brightness(1); box-shadow: 0 0 0 rgba(255,255,255,0); }
      }
      .tile-animation-merge { 
        animation: mergePop 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; 
        animation-fill-mode: both; /* Ensure starting state is applied during delay */
        z-index: 30; 
      }

      /* Heavy Merge (32-256) - Slower, heavier */
      @keyframes mergePopHeavy {
        0% { transform: scale(0.8); filter: brightness(2); }
        40% { transform: scale(1.35); filter: brightness(2.5) contrast(1.5); box-shadow: 0 0 60px rgba(255,200,50,0.5); }
        100% { transform: scale(1); filter: brightness(1); }
      }
      .tile-animation-merge-heavy {
        animation: mergePopHeavy 0.45s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        animation-fill-mode: both;
        z-index: 35;
      }

      /* Epic Merge (512+) - Massive shake and flash */
      @keyframes mergePopEpic {
        0% { transform: scale(0.2) rotate(45deg); filter: brightness(3) sepia(1); opacity: 0.5; }
        60% { transform: scale(1.5) rotate(0deg); filter: brightness(3) contrast(2); box-shadow: 0 0 100px rgba(255,255,255,0.9); opacity: 1; }
        100% { transform: scale(1); filter: brightness(1); opacity: 1; }
      }
      .tile-animation-merge-epic {
        animation: mergePopEpic 0.6s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        animation-fill-mode: both;
        z-index: 40;
      }

      /* Shockwave Ripple */
      @keyframes ripple {
        0% { transform: scale(0.8); opacity: 0.8; border-width: 4px; }
        100% { transform: scale(2); opacity: 0; border-width: 0px; }
      }
      .animate-ripple {
        animation: ripple 0.5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
      }

      /* XP Bar Glow Pulse */
      @keyframes barGlow {
        0%, 100% { filter: brightness(1) drop-shadow(0 0 2px rgba(255,255,255,0.2)); }
        50% { filter: brightness(1.5) drop-shadow(0 0 8px rgba(255,255,255,0.5)); }
      }
      .xp-bar-glow { animation: barGlow 0.5s ease-in-out; }

      /* Screen/Tile Shake Intensities */
      @keyframes shakeSmall {
        0%, 100% { transform: translate(0, 0); }
        25% { transform: translate(-1px, 1px); }
        75% { transform: translate(1px, -1px); }
      }
      /* Invalid Move Shake */
      @keyframes shakeHorizontal {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
        20%, 40%, 60%, 80% { transform: translateX(4px); }
      }
      
      .animate-shake-sm { animation: shakeSmall 0.2s ease-in-out; } 
      .animate-shake-md { animation: shakeSmall 0.3s ease-in-out infinite; } 
      .animate-shake-lg { animation: shakeSmall 0.4s ease-in-out infinite; }
      .animate-shake-horizontal { animation: shakeHorizontal 0.3s cubic-bezier(.36,.07,.19,.97) both; }

      /* XP Bar Shimmer */
      @keyframes shimmer {
        0% { transform: translateX(-150%) skewX(-20deg); }
        100% { transform: translateX(200%) skewX(-20deg); }
      }
      .animate-shimmer {
        animation: shimmer 2s linear infinite;
      }

      /* Level Up Sunburst */
      @keyframes spinSlow {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
      }
      .animate-spin-slow { animation: spinSlow 20s linear infinite; }

      /* God Tile Pulse */
      @keyframes godwave {
        0% { transform: scale(1); opacity: 0.8; box-shadow: 0 0 20px gold; }
        100% { transform: scale(1.5); opacity: 0; box-shadow: 0 0 60px gold; }
      }
      .animate-godwave { animation: godwave 2s infinite; }

      /* VISUAL FX: Chromatic Aberration */
      @keyframes chromaticShake {
        0% { text-shadow: 2px 0 rgba(255,0,0,0.5), -2px 0 rgba(0,255,255,0.5); transform: translate(2px, 1px); }
        25% { text-shadow: -2px 0 rgba(255,0,0,0.5), 2px 0 rgba(0,255,255,0.5); transform: translate(-1px, -2px); }
        50% { text-shadow: 2px 0 rgba(255,0,0,0.5), -2px 0 rgba(0,255,255,0.5); transform: translate(-3px, 0); }
        75% { text-shadow: -2px 0 rgba(255,0,0,0.5), 2px 0 rgba(0,255,255,0.5); transform: translate(3px, 2px); }
        100% { text-shadow: 2px 0 rgba(255,0,0,0.5), -2px 0 rgba(0,255,255,0.5); transform: translate(0, 0); }
      }
      .chromatic-shake { animation: chromaticShake 0.3s ease-in-out infinite; }

      /* LIVING TILE ANIMATIONS */
      @keyframes gradient-xy {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
      }
      .animate-living-slow {
          background-size: 200% 200%;
          animation: gradient-xy 5s ease infinite;
      }
      .animate-living-fast {
          background-size: 200% 200%;
          animation: gradient-xy 2s ease infinite;
      }

      .fog-wrapper {
        position: absolute;
        bottom: 0; left: 0; width: 200%; height: 60vh; display: flex; animation: fogDrift 60s linear infinite; pointer-events: none; z-index: 20; opacity: 0.5; filter: blur(50px);
        mask-image: linear-gradient(to top, black 20%, transparent 100%);
        -webkit-mask-image: linear-gradient(to top, black 20%, transparent 100%);
      }
      .fog-piece { width: 50%; height: 100%; background: linear-gradient(90deg, transparent 0%, rgba(200, 210, 230, 0.12) 50%, transparent 100%); }
      @keyframes fogDrift { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

      /* Boss Lightning & Flash */
      @keyframes lightning {
        0% { opacity: 0; transform: translate(-50%, -100%) scaleY(0); }
        20% { opacity: 1; transform: translate(-50%, -10%) scaleY(1); }
        40% { opacity: 0; }
        60% { opacity: 1; }
        100% { opacity: 0; }
      }
      @keyframes flash {
        0% { opacity: 1; }
        100% { opacity: 0; }
      }
      
      /* New Holographic & Torch Effects */
      .holo-sheen {
        background: linear-gradient(
          115deg, 
          transparent 0%, 
          rgba(255, 255, 255, 0.05) 30%, 
          rgba(255, 255, 255, 0.3) 45%, 
          rgba(255, 255, 255, 0.05) 60%, 
          transparent 100%
        );
        background-size: 200% 200%;
        background-position: calc(var(--mouse-x, 0.5) * 100%) calc(var(--mouse-y, 0.5) * 100%);
        mix-blend-mode: overlay;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "framer-motion": "https://aistudiocdn.com/framer-motion@^11.0.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "path": "https://esm.sh/path@^0.12.7",
    "vite": "https://esm.sh/vite@^7.3.0",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2",
    "url": "https://esm.sh/url@^0.11.4"
  }
}
</script>
  <script>
    // Ensure window.focus() on click for itch.io iframe compatibility
    window.addEventListener('mousedown', function() {
      window.focus();
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(registration => {
          console.log('SW registered:', registration);
        }).catch(error => {
          console.log('SW registration failed:', error);
        });
      });
    }
  </script>
</head>
  <body>
    <div id="root"></div>
  </body>
</html>
